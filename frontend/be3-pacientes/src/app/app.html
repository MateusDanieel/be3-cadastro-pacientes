<main>

  <section class="sec-pacientes">
    <div class="container">
      <button type="button" (click)="abrirModal('#modalForm')" class="component__btn--primary sec-pacientes__bt-cadastrar">
        Cadastrar Paciente
      </button>

      <div class="component__table sec-pacientes__table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th colspan="2">Nome</th>
              <th>Dt. Nasc.</th>
              <th>Gênero</th>
              <th>CPF</th>
              <th>RG</th>
              <th>UF do RG</th>
              <th>E-mail</th>
              <th>Celular</th>
              <th>Telefone</th>
              <th>Convênio</th>
              <th>Nº Carteirinha</th>
              <th>Dt. Validade</th>
              <th>Ações</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let p of pacientes">
              <td data-label="ID:">{{p?.id}}</td>
              <td data-label="Nome:" colspan="2">{{p?.nome}} {{p?.sobrenome}}</td>
              <td data-label="Dt. Nasc.:">{{ p?.dataNascimento | date:'dd/MM/yyyy' }}</td>
              <td data-label="Gênero:">{{p?.genero}}</td>
              <td data-label="CPF:">{{p.cpf | mask: '000.000.000-00'}}</td>
              <td data-label="RG:">{{p.rg | mask: '00.000.000-0'}}</td>
              <td data-label="UF do RG:">{{p?.ufRg}}</td>
              <td data-label="E-mail:">
                <a href="mailto:{{p?.email}}" target="_blank">
                  {{p?.email}}
                </a>
              </td>
              <td data-label="Celular:">
                <a href="tel:{{p?.celular}}" target="_blank">
                  {{p.celular | mask: '(00) 00000-0000'}}
                </a>
              </td>
              <td data-label="Telefone:">
                <a href="tel:{{p?.telefone}}" target="_blank">
                  {{p.telefone | mask: '(00) 0000-0000'}}
                </a>
              </td>
              <td data-label="Convênio:">{{ p?.convenio?.nome || getConvenioNome(p?.convenioId) }}</td>
              <td data-label="Nº Carteirinha:">{{p?.numeroCarteirinha}}</td>
              <td data-label="Dt. Validade:">{{p?.validadeCarteirinha | date:'dd/MM/yyyy' }}</td>
              <td data-label="" class="sec-pacientes__table__actions">
                <button type="button" (click)="editarPaciente(p)" class="component__btn--success sec-pacientes__table__actions__bt">
                  <i class="fa-solid fa-pen-to-square"></i>
                </button>

                <button type="button" (click)="inativarPaciente(p.id)" class="component__btn--danger sec-pacientes__table__actions__bt">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

</main>

<div class="modal-form" id="modalForm" role="dialog" aria-modal="true" hidden (mousedown)="onBackdropClick($event, '#modalForm')">
  <div class="modal-form__content">
    
    <form (ngSubmit)="onSubmit()" #pacienteForm="ngForm" class="modal-form__content__form">

        <label for="novoPacienteNome">Nome</label>
        <input type="text" id="novoPacienteNome" name="nome" [(ngModel)]="novoPaciente.nome" required />

        <label for="novoPacienteSobrenome">Sobrenome</label>
        <input type="text" id="novoPacienteSobrenome" name="sobrenome" [(ngModel)]="novoPaciente.sobrenome" required />

        <label for="novoPacienteDtNasc">Data de Nascimento</label>
        <input type="date" id="novoPacienteDtNasc" name="dataNascimento" [(ngModel)]="novoPaciente.dataNascimento" [(ngModel)]="novoPaciente.dataNascimento" appDataFutura #dataNascimento="ngModel" required />

        <small *ngIf="dataNascimento.errors?.['dataFutura'] && dataNascimento.touched" class="error">
          A data de nascimento não pode ser no futuro.
        </small>

        <label for="novoPacienteGenero">Gênero</label>
        <select name="genero" [(ngModel)]="novoPaciente.genero" id="novoPacienteGenero">
          <option value="Masculino">Masculino</option>
          <option value="Feminino">Feminino</option>
          <option value="Outro">Outro</option>
        </select>

        <label for="novoPacienteCpf">CPF</label>
        <input
          type="text"
          id="novoPacienteCpf"
          name="cpf"
          mask="000.000.000-00"
          [(ngModel)]="novoPaciente.cpf"
          cpfValidator
          cpfDuplicate
          [cpfOriginal]="cpfOriginal"
          [pacienteId]="pacienteEditandoId"
          #cpf="ngModel"
          [disabled]="editando && !!cpfOriginal"
        />

        <small *ngIf="cpf.errors?.['cpfInvalido'] && cpf.touched" class="error">
          Informe um CPF válido.
        </small>

        <small *ngIf="cpf.errors?.['cpfJaExiste']  && cpf.touched" class="error">
          Este CPF já está cadastrado.
        </small>

        <label for="novoPacienteRg">RG</label>
        <input type="text" id="novoPacienteRg" name="rg" mask="00.000.000-0" [(ngModel)]="novoPaciente.rg" />

        <label for="novoPacienteUfRg">UF do RG</label>
        <select name="ufRg" [(ngModel)]="novoPaciente.ufRg" id="novoPacienteUfRg">
          <option value="AC">AC</option>
          <option value="AL">AL</option>
          <option value="AP">AP</option>
          <option value="AM">AM</option>
          <option value="BA">BA</option>
          <option value="CE">CE</option>
          <option value="DF">DF</option>
          <option value="ES">ES</option>
          <option value="GO">GO</option>
          <option value="MA">MA</option>
          <option value="MT">MT</option>
          <option value="MS">MS</option>
          <option value="MG">MG</option>
          <option value="PA">PA</option>
          <option value="PB">PB</option>
          <option value="PR">PR</option>
          <option value="PE">PE</option>
          <option value="PI">PI</option>
          <option value="RJ">RJ</option>
          <option value="RN">RN</option>
          <option value="RS">RS</option>
          <option value="RO">RO</option>
          <option value="RR">RR</option>
          <option value="SC">SC</option>
          <option value="SP">SP</option>
          <option value="SE">SE</option>
          <option value="TO">TO</option>
        </select>

        <label for="novoPacienteEmail">E-mail</label>
        <input 
          type="email" 
          id="novoPacienteEmail" 
          name="email" 
          [(ngModel)]="novoPaciente.email" 
          emailValidator 
          #email="ngModel" 
          required 
        />

        <small *ngIf="email.errors?.['emailInvalido'] && email.touched" class="error">
          Informe um endereço de e-mail válido.
        </small>

        <div ngModelGroup="contatos" #contatos="ngModelGroup" telefoneObrigatorio>

          <label for="novoPacienteCelular">Celular</label>
          <input
            type="tel"
            id="novoPacienteCelular"
            name="celular"
            mask="(00) 00000-0000"
            [(ngModel)]="novoPaciente.celular"
          />

          <label for="novoPacienteTelefone">Telefone</label>
          <input
            type="tel"
            id="novoPacienteTelefone"
            name="telefone"
            mask="(00) 0000-0000"
            [(ngModel)]="novoPaciente.telefone"
          />

          <small *ngIf="contatos?.errors?.['telefoneObrigatorio'] && contatos.touched" class="error">
            Informe pelo menos um número de contato (celular ou telefone).
          </small>

        </div>

        <label for="novoPacienteConvenio">Convênio</label>
        <select id="novoPacienteConvenio" name="convenioId" [(ngModel)]="novoPaciente.convenioId" required>
          <option *ngFor="let item of convenios" [ngValue]="item.id">
            {{ item.nome }}
          </option>
        </select>

        <label for="novoPacienteNmrCarteirinhaConvenio">Nº da Carteirinha do Convênio</label>
        <input type="text" id="novoPacienteNmrCarteirinhaConvenio" name="numeroCarteirinha" [(ngModel)]="novoPaciente.numeroCarteirinha" required />

        <label for="novoPacienteValidadeCarteirinha">Validade da Carteirinha do Convênio</label>
        <input type="date" id="novoPacienteValidadeCarteirinha" name="validadeCarteirinha" [(ngModel)]="novoPaciente.validadeCarteirinha" required />

        <div class="modal-form__content__actions">
          <button type="submit" [disabled]="pacienteForm.invalid" class="modal-form__content__form__actions__bt-salvar component__btn--primary">
            Salvar
          </button>

          <button type="button" class="modal-form__content__form__actions__bt-fechar component__btn--secondary" (click)="fecharModal('#modalForm')">
            Fechar
          </button>
        </div>

        
      </form>
  </div>
</div>



<router-outlet />